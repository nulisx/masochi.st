<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Check - Glowi.es</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 499.8 499.8'%3E%3Cpath fill='%239333ea' d='M477.16,292.045c0,0-62.848-4.221-125.061,22.069c11.664-13.634,23.084-28.804,33.416-45.603c51.428-83.723,56.047-174.385,56.047-174.385s-78.774,45.1-130.221,128.822c-7.563,12.3-13.99,24.738-19.668,37.029c3.467-20.557,5.744-42.617,5.744-65.72C297.417,86.977,249.892,0,249.892,0s-47.506,86.977-47.506,194.259c0,23.102,2.279,45.163,5.742,65.713c-5.68-12.293-12.123-24.723-19.67-37.023C137.017,139.227,58.238,94.127,58.238,94.127s4.623,90.662,56.05,174.385c10.329,16.799,21.75,31.969,33.416,45.603C85.472,287.824,22.64,292.045,22.64,292.045s37.99,47.329,100.418,73.905c23.818,10.137,47.734,15.764,68.231,18.881c-9.681,0.716-19.997,2.132-30.503,4.71c-45.443,11.111-77.006,38.909-77.006,38.909s42.105,9.768,87.561-1.351c29.467-7.217,52.928-21.347,65.893-30.448l-10.852,86.821c-0.506,4.125,0.635,8.272,3.157,11.404c2.522,3.125,6.147,4.923,9.974,4.923h20.791c3.826,0,7.451-1.798,9.975-4.923c2.522-3.132,3.66-7.279,3.156-11.404l-10.852-86.814c12.967,9.103,36.426,23.225,65.875,30.441c45.457,11.118,87.561,1.351,87.561,1.351s-31.564-27.798-77.002-38.909c-10.512-2.578-20.828-3.994-30.508-4.71c20.504-3.117,44.42-8.744,68.238-18.881C439.173,339.374,477.16,292.045,477.16,292.045z'/%3E%3C/svg%3E">
    <link rel="stylesheet" href="/static/css/verify.css">
</head>
<body>
    <div class="verify-container">
        <h1 class="logo-text"><span>Glowi</span>.es</h1>
        
        <p class="verify-title">Verifying your browser security...</p>
        
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <p class="verify-status" id="statusText">This process usually takes a few seconds...</p>
        
        <div class="verify-message" id="verifyMessage">
            Almost done... We're performing additional security checks to ensure a safe connection.
        </div>
        
        <div class="checkmark" id="checkmark">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        </div>
    </div>

    <script>
        const progressBar = document.getElementById('progressBar');
        const statusText = document.getElementById('statusText');
        const verifyMessage = document.getElementById('verifyMessage');
        const checkmark = document.getElementById('checkmark');
        
        const redirectUrl = new URLSearchParams(window.location.search).get('redirect') || '/';
        
        let progress = 0;
        const totalDuration = 3000;
        const interval = 50;
        const increment = (interval / totalDuration) * 100;
        
        function updateProgress() {
            progress += increment + (Math.random() * 2);
            if (progress > 100) progress = 100;
            progressBar.style.width = progress + '%';
            
            if (progress >= 50 && !verifyMessage.classList.contains('show')) {
                verifyMessage.classList.add('show');
            }
            
            if (progress >= 100) {
                clearInterval(timer);
                completeVerification();
            }
        }
        
        function completeVerification() {
            statusText.textContent = 'Verification complete!';
            verifyMessage.style.display = 'none';
            checkmark.classList.add('show');
            
            document.cookie = 'browser_verified=true; path=/; max-age=86400; SameSite=Strict';
            
            setTimeout(() => {
                window.location.href = redirectUrl;
            }, 800);
        }
        
        function collectBrowserFingerprint() {
            const data = {
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screenWidth: screen.width,
                screenHeight: screen.height,
                colorDepth: screen.colorDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                cookiesEnabled: navigator.cookieEnabled,
                doNotTrack: navigator.doNotTrack,
                timestamp: Date.now()
            };
            return data;
        }
        
        async function performVerification() {
            const fingerprint = collectBrowserFingerprint();
            
            try {
                await fetch('/api/verify/browser', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(fingerprint)
                });
            } catch (e) {
            }
        }
        
        const timer = setInterval(updateProgress, interval);
        performVerification();
    </script>
</body>
</html>
