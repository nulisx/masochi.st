<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Advanced Keyboard Sounds Controller Overlay</title>
<style>
:root{
  --accent:#7c3aed;
  --accent-light:#a855f7;
  --text:#e6eef8;
  --muted:#6b7280;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  background:linear-gradient(135deg,#030511 0%,#0a0f1f 50%,#050a15 100%);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:16px;
}
.main{
  display:grid;
  grid-template-columns:1fr 900px;
  gap:32px;
  max-width:1600px;
  width:100%;
}
.panel{
  background:linear-gradient(135deg,rgba(124,58,237,0.08),rgba(168,85,247,0.04));
  border:1px solid rgba(168,85,247,0.15);
  padding:32px;
  border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,0.5);
  backdrop-filter:blur(10px);
}
.title{display:flex;gap:16px;margin-bottom:28px}
.logo{
  width:60px;height:60px;border-radius:14px;
  background:linear-gradient(135deg,#7c3aed,#a855f7);
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:24px;box-shadow:0 8px 24px rgba(124,58,237,0.4);
  flex-shrink:0;color:white;
}
.title-text h1{font-size:26px;font-weight:800}
.title-text p{font-size:13px;color:var(--muted);margin:4px 0 0}
.controls{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:12px;margin-bottom:24px}
.btn{
  background:linear-gradient(135deg,rgba(168,85,247,0.2),rgba(124,58,237,0.1));
  border:1px solid rgba(168,85,247,0.4);
  padding:12px 16px;border-radius:10px;color:var(--text);font-weight:600;
  font-size:13px;cursor:pointer;transition:all 0.3s;
}
.btn:hover{background:linear-gradient(135deg,rgba(168,85,247,0.3),rgba(124,58,237,0.2));border-color:rgba(168,85,247,0.7);transform:translateY(-2px)}
.btn.active{background:linear-gradient(135deg,rgba(168,85,247,0.5),rgba(124,58,237,0.3));box-shadow:0 0 20px rgba(168,85,247,0.5)}
.row{display:flex;gap:12px;align-items:center;margin-bottom:16px;flex-wrap:wrap}
.label{font-size:12px;color:var(--muted);font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
.select,.range{
  background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(124,58,237,0.05));
  border:1px solid rgba(168,85,247,0.2);color:var(--text);border-radius:8px;font-size:13px;padding:10px 12px;
}
.select{cursor:pointer}
.range{appearance:none;width:100%;height:4px;padding:0}
.range::-webkit-slider-thumb{appearance:none;width:16px;height:16px;background:linear-gradient(135deg,#7c3aed,#a855f7);border-radius:50%;cursor:pointer;box-shadow:0 4px 12px rgba(124,58,237,0.4)}
.status-box{background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);padding:14px;border-radius:12px;display:flex;gap:12px;align-items:center;margin-bottom:20px}
.indicator{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.2);animation:pulse 2s ease-in-out infinite}
.indicator.connected{background:#10b981;box-shadow:0 0 12px rgba(16,185,129,0.8)}
.info{font-size:12px;color:var(--muted)}
.info-strong{color:var(--text);font-weight:600}
.info-box{background:rgba(99,102,241,0.08);border:1px dashed rgba(99,102,241,0.2);padding:12px;border-radius:10px;font-size:12px;color:var(--muted);line-height:1.6;margin-bottom:20px}
.keys-section{margin-bottom:20px}
.keys-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;font-weight:600}
.keys-display{display:flex;flex-wrap:wrap;gap:8px}
.key-chip{
  background:linear-gradient(135deg,rgba(168,85,247,0.25),rgba(124,58,237,0.15));
  border:1px solid rgba(168,85,247,0.4);padding:8px 12px;border-radius:8px;
  font-size:12px;font-weight:600;color:var(--accent-light);animation:slideIn 0.3s ease-out;
}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px)}to{opacity:1;transform:translateX(0)}}
@keyframes pulse{0%,100%{opacity:0.5}50%{opacity:1}}
.controller-panel{display:flex;flex-direction:column}
.controller-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.controller-header h2{margin:0;font-size:18px;font-weight:700}
.controller-container{
  background:linear-gradient(135deg,#0a0e1a,#050812);
  border:1px solid rgba(168,85,247,0.2);border-radius:16px;padding:40px;
  display:flex;align-items:center;justify-content:center;min-height:600px;
  margin-bottom:20px;position:relative;
}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.stat-box{background:rgba(255,255,255,0.02);border:1px solid rgba(168,85,247,0.15);padding:12px;border-radius:10px}
.stat-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px}
.stat-value{font-size:13px;color:var(--accent-light);font-weight:700;font-family:monospace}
.controller{
  width:800px;height:500px;position:relative;
  background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 500"><defs><radialGradient id="controllerGrad" cx="40%" cy="40%"><stop offset="0%" style="stop-color:%23444444"/><stop offset="100%" style="stop-color:%23111111"/></radialGradient><filter id="controllerShadow"><feDropShadow dx="0" dy="10" stdDeviation="8" flood-opacity="0.6"/></filter></defs><g filter="url(%23controllerShadow)"><path d="M 80 150 Q 40 180 40 250 Q 40 380 150 420 L 650 420 Q 760 380 760 250 Q 760 180 720 150" fill="url(%23controllerGrad)" stroke="%23222222" stroke-width="1"/><ellipse cx="120" cy="200" rx="50" ry="70" fill="%23222222" stroke="%23333333" stroke-width="1"/><ellipse cx="680" cy="200" rx="50" ry="70" fill="%23222222" stroke="%23333333" stroke-width="1"/></g></svg>') center/cover no-repeat;
}
.bumpers{display:flex;justify-content:space-between;width:100%;height:60px;position:absolute;top:20px;padding:0 80px}
.bumper{width:80px;height:20px;background:linear-gradient(to bottom,#333,#111);border-radius:10px;border:1px solid #222;cursor:default;transition:all 0.05s;position:relative}
.bumper.active{background:linear-gradient(to bottom,#7c3aed,#5a1db5);box-shadow:0 0 15px rgba(124,58,237,0.6);transform:translateY(2px)}
.triggers{display:flex;justify-content:space-between;width:100%;padding:0 80px;position:absolute;top:50px;height:40px}
.trigger-visual{width:70px;height:35px;background:linear-gradient(to bottom,#2a2a2a,#0a0a0a);border-radius:8px;border:1px solid #1a1a1a;position:relative;transition:all 0.05s}
.trigger-visual.active{background:linear-gradient(to bottom,#a855f7,#7c3aed);box-shadow:0 0 12px rgba(168,85,247,0.5)}
.dpad{position:absolute;left:120px;top:280px;width:60px;height:60px;background:#222;border-radius:8px;display:grid;grid-template:1fr 1fr 1fr/1fr 1fr 1fr;gap:4px;padding:8px}
.dpad-btn{background:#111;border:1px solid #333;border-radius:4px;cursor:default;transition:all 0.05s;display:flex;align-items:center;justify-content:center;font-size:12px;color:#666}
.dpad-btn.active{background:#a855f7;color:#fff;box-shadow:0 0 8px rgba(168,85,247,0.8)}
.dpad-up{grid-column:2;grid-row:1}
.dpad-left{grid-column:1;grid-row:2}
.dpad-center{grid-column:2;grid-row:2}
.dpad-right{grid-column:3;grid-row:2}
.dpad-down{grid-column:2;grid-row:3}
.buttons{position:absolute;right:120px;top:240px;width:120px;height:120px}
.button-group{position:absolute;width:100%;height:100%}
.button-circle{
  width:48px;height:48px;border-radius:50%;position:absolute;
  border:2px solid;cursor:default;display:flex;align-items:center;justify-content:center;
  font-weight:bold;font-size:20px;transition:all 0.05s;
}
.button-circle.active{transform:scale(0.85);box-shadow:inset 0 2px 4px rgba(0,0,0,0.8),0 0 12px currentColor}
.btn-x{background:#5a3aaa;border-color:#3a1a8a;color:#fff;left:0;top:36px}
.btn-x.active{background:#7c3aed;box-shadow:inset 0 2px 4px rgba(0,0,0,0.8),0 0 15px rgba(124,58,237,0.8)}
.btn-y{background:#2aaa4a;border-color:#1a8a2a;color:#fff;left:36px;top:0}
.btn-y.active{background:#3aed5a;box-shadow:inset 0 2px 4px rgba(0,0,0,0.8),0 0 15px rgba(58,237,90,0.8)}
.btn-a{background:#aa2a3a;border-color:#8a1a1a;color:#fff;right:36px;top:0}
.btn-a.active{background:#ed3a4a;box-shadow:inset 0 2px 4px rgba(0,0,0,0.8),0 0 15px rgba(237,58,74,0.8)}
.btn-b{background:#2a4aaa;border-color:#1a2a8a;color:#fff;right:0;top:36px}
.btn-b.active{background:#3a6aed;box-shadow:inset 0 2px 4px rgba(0,0,0,0.8),0 0 15px rgba(58,106,237,0.8)}
.sticks{position:absolute;bottom:60px;width:100%;padding:0 80px;display:flex;justify-content:space-between}
.stick-pad{width:80px;height:80px;background:radial-gradient(circle at 30% 30%,#444,#0a0a0a);border-radius:50%;border:3px solid #222;position:relative;display:flex;align-items:center;justify-content:center}
.stick{
  width:50px;height:50px;background:radial-gradient(circle at 35% 35%,#555,#111);
  border-radius:50%;position:absolute;transition:all 0.05s;border:2px solid #333;
  display:flex;align-items:center;justify-content:center;font-size:11px;color:#888;
}
.stick.active{background:radial-gradient(circle at 35% 35%,#a855f7,#5a1db5);border-color:#7c3aed;box-shadow:0 0 12px rgba(168,85,247,0.6);color:#fff}
.center-buttons{position:absolute;bottom:80px;width:100%;display:flex;justify-content:center;gap:30px}
.center-btn{width:60px;height:24px;background:#1a1a1a;border:1px solid #333;border-radius:4px;cursor:default;transition:all 0.05s;font-size:10px;color:#666;display:flex;align-items:center;justify-content:center}
.center-btn.active{background:#a855f7;color:#fff;box-shadow:0 0 10px rgba(168,85,247,0.6)}
.touchpad{position:absolute;bottom:120px;left:50%;transform:translateX(-50%);width:200px;height:120px;background:#0a0a0a;border:2px solid #333;border-radius:8px;cursor:default;transition:all 0.05s}
.touchpad.active{border-color:#a855f7;box-shadow:0 0 15px rgba(168,85,247,0.5)}
@media (max-width:1200px){
  .main{grid-template-columns:1fr}
  .controller{width:100%;max-width:700px;height:auto;aspect-ratio:800/500}
}
</style>
</head>
<body>
<div class="main">
  <div class="panel">
    <div class="title">
      <div class="logo">KS</div>
      <div>
        <h1>Keyboard Sounds</h1>
        <p>Advanced controller & keyboard ASMR overlay</p>
      </div>
    </div>

    <div class="controls">
      <button id="startBtn" class="btn">‚ñ∂ Start Audio</button>
      <button id="scanBtn" class="btn">‚Üª Scan</button>
      <select id="profile" class="select">
        <option value="mechanical">Mechanical</option>
        <option value="cherry">Cherry MX</option>
        <option value="typewriter">Typewriter</option>
        <option value="bubble">Bubble</option>
        <option value="linear">Linear</option>
      </select>
    </div>

    <div class="row">
      <label class="label">Volume</label>
      <input type="range" id="volume" class="range" min="0" max="1" step="0.01" value="0.7" style="flex:1;max-width:150px;"/>
      <span id="volDisplay" style="font-size:12px;color:var(--accent-light);min-width:35px;">70%</span>
    </div>

    <div class="status-box">
      <span class="indicator" id="gpIndicator"></span>
      <div>
        <div class="info"><span class="info-strong" id="gpName">No Controller</span></div>
        <div class="info" id="gpInfo" style="font-size:11px;margin-top:2px;"></div>
      </div>
    </div>

    <div class="info-box">
      üéÆ Connect PS4, PS5, or Xbox controller. Press buttons or move sticks to trigger ASMR keyboard sounds.
    </div>

    <div class="keys-section">
      <div class="keys-label">Keyboard Input</div>
      <div class="keys-display" id="recentKeys"></div>
    </div>

    <div class="keys-section">
      <div class="keys-label">Button Input</div>
      <div class="keys-display" id="recentButtons"></div>
    </div>

    <div class="keys-section">
      <div class="keys-label">Analog Input</div>
      <div class="keys-display" id="recentAnalog"></div>
    </div>
  </div>

  <div class="panel controller-panel">
    <div class="controller-header">
      <h2>Controller Overlay</h2>
      <label style="font-size:12px;color:var(--muted);display:flex;gap:8px;">
        <input type="checkbox" id="autoRepeat" checked/>
        Auto-repeat
      </label>
    </div>
    <div class="controller-container">
      <div class="controller" id="controller">
        <div class="bumpers">
          <div class="bumper" id="btn4"></div>
          <div class="bumper" id="btn5"></div>
        </div>
        <div class="triggers">
          <div class="trigger-visual" id="tri0"></div>
          <div class="trigger-visual" id="tri1"></div>
        </div>
        <div class="dpad">
          <div class="dpad-btn dpad-up" id="dpad-up">‚Üë</div>
          <div class="dpad-btn dpad-left" id="dpad-left">‚Üê</div>
          <div class="dpad-btn dpad-center"></div>
          <div class="dpad-btn dpad-right" id="dpad-right">‚Üí</div>
          <div class="dpad-btn dpad-down" id="dpad-down">‚Üì</div>
        </div>
        <div class="buttons">
          <div class="button-circle btn-x" id="btn2">‚úï</div>
          <div class="button-circle btn-y" id="btn3">‚ñ≥</div>
          <div class="button-circle btn-a" id="btn1">‚óØ</div>
          <div class="button-circle btn-b" id="btn0">‚ñ¢</div>
        </div>
        <div class="sticks">
          <div class="stick-pad">
            <div class="stick" id="stick0">L</div>
          </div>
          <div class="stick-pad">
            <div class="stick" id="stick1">R</div>
          </div>
        </div>
        <div class="center-buttons">
          <div class="center-btn" id="btn8">SHARE</div>
          <div class="center-btn" id="btn16">PS</div>
          <div class="center-btn" id="btn9">OPT</div>
        </div>
        <div class="touchpad" id="touchpad"></div>
      </div>
    </div>
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-label">L Stick</div>
        <div class="stat-value" id="lStick">x:0.00 y:0.00</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">R Stick</div>
        <div class="stat-value" id="rStick">x:0.00 y:0.00</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Triggers</div>
        <div class="stat-value" id="triggers">L:0.00 R:0.00</div>
      </div>
      <div class="stat-box">
        <div class="stat-label">Profile</div>
        <div class="stat-value" id="profileName">Mechanical</div>
      </div>
    </div>
  </div>
</div>

<script>
let audioCtx=null,masterGain=null,isRunning=false,profile="mechanical";
let connectedGpIndex=null,prevButtonStates=[],prevAxes=[];
let lastPressTimes={};

const soundLibrary={
  mechanical:{freq:2200,q:1.8,dur:0.045},
  cherry:{freq:2600,q:1.5,dur:0.05},
  typewriter:{freq:3200,q:0.9,dur:0.055},
  bubble:{freq:1800,q:2.2,dur:0.04},
  linear:{freq:2000,q:1.4,dur:0.035}
};

const elements={
  startBtn:document.getElementById("startBtn"),
  scanBtn:document.getElementById("scanBtn"),
  profile:document.getElementById("profile"),
  volume:document.getElementById("volume"),
  volDisplay:document.getElementById("volDisplay"),
  gpIndicator:document.getElementById("gpIndicator"),
  gpName:document.getElementById("gpName"),
  gpInfo:document.getElementById("gpInfo"),
  recentKeys:document.getElementById("recentKeys"),
  recentButtons:document.getElementById("recentButtons"),
  recentAnalog:document.getElementById("recentAnalog"),
  lStick:document.getElementById("lStick"),
  rStick:document.getElementById("rStick"),
  triggers:document.getElementById("triggers"),
  profileName:document.getElementById("profileName"),
  autoRepeat:document.getElementById("autoRepeat")
};

function initAudio(){
  if(audioCtx)return;
  audioCtx=new(window.AudioContext||window.webkitAudioContext)();
  masterGain=audioCtx.createGain();
  masterGain.gain.value=Number(elements.volume.value);
  masterGain.connect(audioCtx.destination);
}

elements.startBtn.addEventListener("click",()=>{
  initAudio();if(audioCtx.state==="suspended")audioCtx.resume();
  isRunning=true;elements.startBtn.classList.add("active");elements.startBtn.textContent="‚è∏ Running";
});

elements.profile.addEventListener("change",(e)=>{
  profile=e.target.value;elements.profileName.textContent=profile.charAt(0).toUpperCase()+profile.slice(1);
});

elements.volume.addEventListener("input",(e)=>{
  const vol=Math.round(Number(e.target.value)*100);elements.volDisplay.textContent=vol+"%";
  if(masterGain)masterGain.gain.value=Number(e.target.value);
});

elements.scanBtn.addEventListener("click",()=>scanGamepads(true));

function playSound(kind=profile,velocity=1){
  if(!audioCtx)return;
  const now=audioCtx.currentTime;
  const config=soundLibrary[kind]||soundLibrary.mechanical;
  const noise=audioCtx.createBufferSource();
  const bufLen=Math.floor(audioCtx.sampleRate*config.dur);
  const buffer=audioCtx.createBuffer(1,bufLen,audioCtx.sampleRate);
  const data=buffer.getChannelData(0);
  for(let i=0;i<bufLen;i++){
    data[i]=(Math.random()*2-1)*Math.exp(-i/bufLen*7)*velocity*0.9;
  }
  noise.buffer=buffer;
  const filter=audioCtx.createBiquadFilter();
  filter.type="bandpass";filter.frequency.value=config.freq;filter.Q.value=config.q;
  const gain=audioCtx.createGain();gain.gain.value=0.75;
  noise.connect(filter);filter.connect(gain);gain.connect(masterGain);
  noise.start(now);noise.stop(now+config.dur);
}

window.addEventListener("keydown",(e)=>{
  if(!isRunning||["Shift","Control","Alt","Meta"].includes(e.key))return;
  const chip=document.createElement("div");chip.className="key-chip";chip.textContent=e.key;
  elements.recentKeys.prepend(chip);while(elements.recentKeys.children.length>10)elements.recentKeys.removeChild(elements.recentKeys.lastChild);
  playSound(profile,1.0);
});

function scanGamepads(force=false){
  const gps=navigator.getGamepads?navigator.getGamepads():[];
  let found=false;
  for(let i=0;i<gps.length;i++){
    const g=gps[i];
    if(g&&g.connected){
      found=true;connectedGpIndex=i;
      prevButtonStates=new Array(g.buttons.length).fill(false);
      prevAxes=new Array(g.axes.length).fill(0);
      elements.gpIndicator.classList.add("connected");
      elements.gpName.textContent="Controller Connected";
      elements.gpInfo.textContent=g.id.substring(0,50);
      break;
    }
  }
  if(!found){
    elements.gpIndicator.classList.remove("connected");
    elements.gpName.textContent="No Controller";elements.gpInfo.textContent="";
    connectedGpIndex=null;
  }
}

function pollGamepad(){
  const gps=navigator.getGamepads?navigator.getGamepads():[];
  const g=connectedGpIndex!==null?gps[connectedGpIndex]:null;
  if(!g){
    for(let i=0;i<gps.length;i++){if(gps[i]&&gps[i].connected){connectedGpIndex=i;scanGamepads(true);break}}
    requestAnimationFrame(pollGamepad);return;
  }
  const buttons=g.buttons;
  for(let i=0;i<buttons.length;i++){
    const pressed=buttons[i].pressed||buttons[i].value>0.1;
    const prev=prevButtonStates[i]||false;
    if(pressed&&(!prev||elements.autoRepeat.checked)){
      const now=performance.now();
      const key="b"+i;
      if(!lastPressTimes[key]||(now-lastPressTimes[key]>80)){
        lastPressTimes[key]=now;
        if(isRunning){
          const el=document.getElementById("btn"+i);
          if(el)el.classList.add("active");
          const names=["‚ñ¢","‚óØ","‚úï","‚ñ≥","L1","R1","L2","R2","SHARE","OPT"];
          if(names[i]){
            const chip=document.createElement("div");chip.className="key-chip";chip.textContent=names[i];
            elements.recentButtons.prepend(chip);
            while(elements.recentButtons.children.length>10)elements.recentButtons.removeChild(elements.recentButtons.lastChild);
          }
          playSound(profile,Math.min(1,Math.max(0.2,buttons[i].value||1)));
        }
      }
    }
    if(!pressed&&prev){
      const el=document.getElementById("btn"+i);if(el)el.classList.remove("active");
    }
    prevButtonStates[i]=pressed;
  }
  const axes=g.axes;
  if(axes.length>=4){
    const lx=Math.abs(axes[0])>0.2?axes[0]:0;const ly=Math.abs(axes[1])>0.2?axes[1]:0;
    const rx=Math.abs(axes[2])>0.2?axes[2]:0;const ry=Math.abs(axes[3])>0.2?axes[3]:0;
    elements.lStick.textContent=`x:${lx.toFixed(2)} y:${ly.toFixed(2)}`;
    elements.rStick.textContent=`x:${rx.toFixed(2)} y:${ry.toFixed(2)}`;
    const stick0=document.getElementById("stick0");
    const stick1=document.getElementById("stick1");
    if(stick0){
      stick0.style.transform=`translate(${lx*25}px,${ly*25}px)`;
      if(Math.abs(lx)>0.15||Math.abs(ly)>0.15){stick0.classList.add("active")}else{stick0.classList.remove("active")}
    }
    if(stick1){
      stick1.style.transform=`translate(${rx*25}px,${ry*25}px)`;
      if(Math.abs(rx)>0.15||Math.abs(ry)>0.15){stick1.classList.add("active")}else{stick1.classList.remove("active")}
    }
  }
  const l2=buttons[6]?buttons[6].value:0;const r2=buttons[7]?buttons[7].value:0;
  elements.triggers.textContent=`L:${l2.toFixed(2)} R:${r2.toFixed(2)}`;
  const tri0=document.getElementById("tri0");const tri1=document.getElementById("tri1");
  if(tri0)tri0.style.opacity=l2;if(tri1)tri1.style.opacity=r2;
  if(l2>0.1){if(tri0)tri0.classList.add("active")}else if(tri0)tri0.classList.remove("active");
  if(r2>0.1){if(tri1)tri1.classList.add("active")}else if(tri1)tri1.classList.remove("active");
  requestAnimationFrame(pollGamepad);
}

window.addEventListener("gamepadconnected",()=>scanGamepads(true));
window.addEventListener("gamepaddisconnected",()=>scanGamepads(true));
document.body.addEventListener("pointerdown",()=>{initAudio();if(audioCtx&&audioCtx.state==="suspended")audioCtx.resume()},{once:true});

scanGamepads();pollGamepad();
</script>
</body>
</html>
