import{_ as h,s as g,c as a,a as e,k as m,f as u,v as p,F as b,j as x,t as c,n as y,o as d}from"./index-CRQdNere.js";import{a as w,b as v,g as _,p as z,s as k}from"./admin-DGMd25hE.js";const C={data(){return{form:{username:"",reason:"",date:null},files:[],modal:{visible:!1,type:"",title:"",text:"",actionLabel:"",actionClass:"",reportID:null}}},created(){this.loadFileReports()},computed:{...g("user",["accessToken","username","admin"])},methods:{async setMembership(){let s=this.form.username;const l=(this.form.date?new Date(this.form.date):null).toISOString();try{if(l==null){this.$store.dispatch("user/addNotification",{icon:"fas fa-exclamation-circle",title:"Error",message:"You forgot to input a day/month",type:"error"});return}const i=await k(s,l);if(i.error){this.$store.dispatch("user/addNotification",{icon:"fas fa-exclamation-circle",title:"Error",message:i.error,type:"error"});return}this.$store.dispatch("user/addNotification",{icon:"fas fa-check-circle",title:"Success",message:"The user "+this.form.username+"'s membership has been updated to "+this.form.date,type:"success"})}catch(i){this.$store.dispatch("user/addNotification",{icon:"fas fa-exclamation-circle",title:"Error",message:i.message,type:"error"});return}},async banUser(){try{if(this.form.reason==""){this.$store.dispatch("user/addNotification",{icon:"fas fa-exclamation-circle",title:"Error",message:"Enter a reason to ban the user",type:"error"});return}const s=await z(this.form.username,this.form.reason);if(s.error){this.$store.dispatch("user/addNotification",{icon:"fas fa-exclamation-circle",title:"Error",message:s.error,type:"error"});return}this.$store.dispatch("user/addNotification",{icon:"fas fa-check-circle",title:"Success",message:"The user "+this.form.username+" has been banned",type:"success"})}catch(s){this.$store.dispatch("user/addNotification",{icon:"fas fa-exclamation-circle",title:"Error",message:s.message,type:"error"});return}},async loadFileReports(){try{const s=await _();if(console.log("Raw response from API:",s),!s||!s.reports){console.error("Invalid response format",s);return}const t=await Promise.all(s.reports.map(async l=>{try{const i=await getFileEncryptionKey(l.id);l.hasEncryptionKey=!!(i&&i.key)}catch(i){console.error("Error fetching encryption key for file",l.id,i)}return l}));this.files=t}catch(s){if(console.error("Error loading file reports:",s),s.response){const t=await s.response.text();console.error("Response body:",t)}}},openModal(s,t){this.modal.reportID=t,s==="confirm"?(this.modal.title="Confirm Report",this.modal.text="Are you sure you want to confirm this report as accurate?",this.modal.actionLabel="Confirm",this.modal.actionClass="px-4 py-2 rounded-lg text-white transition-colors bg-red-600 hover:bg-red-700"):s==="allow"&&(this.modal.title="Allow File",this.modal.text="Are you sure you want to allow this file?",this.modal.actionLabel="Allow",this.modal.actionClass="px-4 py-2 rounded-lg text-white transition-colors bg-green-600 hover:bg-green-700"),this.modal.type=s,this.modal.visible=!0},closeModal(){this.modal.visible=!1,this.modal.reportID=null},async handleAction(){try{this.modal.type==="confirm"?(await w(this.modal.reportID),console.log("Report confirmed ✅")):this.modal.type==="allow"&&(await v(this.modal.reportID),console.log("File allowed ✅")),this.closeModal(),this.loadFileReports()}catch(s){console.error("Error handling action:",s)}}}},E={class:"pt-6 md:pl-[1.9rem] pb-[1.9rem] pl-[0.4rem] select-none"},M={key:0,class:""},D={class:"space-y-6 p-6 rounded-xl bg-zinc-900/50 border border-zinc-800/50"},R={class:"grid grid-cols-1 lg:grid-cols-2 gap-4"},A={class:"space-y-2"},F={class:"space-y-2"},U={class:"flex items-center space-x-4"},N={class:"space-y-2"},I={class:"flex items-center space-x-4"},j={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4"},B={key:0,class:"col-span-full text-center p-6 rounded-xl bg-zinc-900/50 border border-zinc-800/50"},S={class:"rounded-lg overflow-hidden mb-4 bg-zinc-800/50 flex items-center justify-center h-40"},V=["src"],L={class:"space-y-1"},P={class:"text-lg font-semibold text-white truncate"},K={class:"text-sm text-zinc-400"},T={class:"text-sm text-zinc-500 truncate"},q={key:0,class:"text-sm text-red-400 font-medium mt-1"},G={class:"flex justify-between mt-4 pt-2 border-t border-zinc-800"},O=["onClick"],W=["onClick"],Y={key:1,class:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-50"},H={class:"bg-zinc-900 border border-zinc-700 rounded-xl p-6 w-[90%] max-w-md"},J={class:"text-xl font-semibold text-white mb-3"},Q={class:"text-zinc-400 mb-6"},X={class:"flex justify-end gap-3"};function Z(s,t,l,i,r,n){return d(),a("div",E,[t[13]||(t[13]=e("div",{class:"d-flex justify-content-between align-items-center flex-wrap grid-margin"},[e("h4",{class:"mb-4 mb-md-0 col-12 col-md-auto text-textPrimary"}," Dashboard / Admin Panel ")],-1)),s.admin?(d(),a("div",M,[t[10]||(t[10]=e("h2",{class:"text-lg font-semibold text-white mb-4"},"Manage Users",-1)),e("div",D,[e("div",R,[e("div",A,[t[7]||(t[7]=e("label",{class:"text-sm text-zinc-400"},"User's Username",-1)),u(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.form.username=o),type:"text",placeholder:"Username",required:"",class:"w-full px-3 py-2 bg-zinc-800/50 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"},null,512),[[p,r.form.username]])]),e("div",F,[t[8]||(t[8]=e("label",{class:"text-sm text-zinc-400"},"Ban Reason",-1)),e("div",U,[u(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>r.form.reason=o),type:"text",placeholder:"Reason for ban",required:"",class:"w-full sm:w-3/4 px-3 py-2 bg-zinc-800/50 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"},null,512),[[p,r.form.reason]]),e("button",{onClick:t[2]||(t[2]=(...o)=>n.banUser&&n.banUser(...o)),type:"button",class:"w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all font-medium"}," Ban User ")])]),e("div",N,[t[9]||(t[9]=e("label",{class:"text-sm text-zinc-400"},"Membership Date",-1)),e("div",I,[u(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.form.date=o),type:"date",required:"",class:"w-full px-3 py-2 bg-zinc-800/50 border border-zinc-700 rounded-lg text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all"},null,512),[[p,r.form.date]]),e("button",{onClick:t[4]||(t[4]=(...o)=>n.setMembership&&n.setMembership(...o)),style:{width:"14em"},type:"button",class:"py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all font-medium"}," Set Membership ")])])])])])):m("",!0),e("div",j,[t[12]||(t[12]=e("h2",{class:"text-lg font-semibold text-white"},"Files awaiting admin opinion",-1)),r.files.length===0?(d(),a("div",B,[...t[11]||(t[11]=[e("p",{class:"text-lg font-semibold text-zinc-400"}," No files awaiting admin approval at the moment. ",-1)])])):m("",!0),(d(!0),a(b,null,x(r.files,o=>(d(),a("div",{key:o.id,class:"p-5 rounded-xl bg-zinc-900/50 border border-zinc-800/50 hover:border-zinc-700/50 transition-colors flex flex-col justify-between"},[e("div",null,[e("div",S,[e("img",{src:`https://api.alo.ne/file/${o.fileId}`||"",alt:"Preview",class:"object-cover w-full h-full"},null,8,V)]),e("div",L,[e("h3",P,c(o.name),1),e("p",K,"Uploaded: "+c(o.createdAt),1),e("p",T,"Key: "+c(o.key),1),o.reason?(d(),a("p",q," Reason: "+c(o.reason),1)):m("",!0)])]),e("div",G,[e("button",{onClick:f=>n.openModal("confirm",o.id),class:"px-3 py-2 text-sm bg-red-600/80 hover:bg-red-700 text-white rounded-lg transition-colors"}," Confirm Report ",8,O),e("button",{onClick:f=>n.openModal("allow",o.id),class:"px-3 py-2 text-sm bg-green-600/80 hover:bg-green-700 text-white rounded-lg transition-colors"}," Allow File ",8,W)])]))),128))]),r.modal.visible?(d(),a("div",Y,[e("div",H,[e("h2",J,c(r.modal.title),1),e("p",Q,c(r.modal.text),1),e("div",X,[e("button",{class:"px-4 py-2 rounded-lg bg-zinc-800 text-zinc-400 hover:bg-zinc-700 transition-colors",onClick:t[5]||(t[5]=(...o)=>n.closeModal&&n.closeModal(...o))}," Cancel "),e("button",{class:y(r.modal.actionClass),onClick:t[6]||(t[6]=(...o)=>n.handleAction&&n.handleAction(...o))},c(r.modal.actionLabel),3)])])])):m("",!0)])}const te=h(C,[["render",Z],["__scopeId","data-v-b1dfcc1f"]]);export{te as default};
