import{C as r,D as h,_ as f,c as a,a as t,k as m,F as b,j as g,t as i,n as x,o as c}from"./index-CRQdNere.js";async function y(e){return await r.dispatch("user/refresh"),(await fetch(`${h}/file/:id/${e}`,{method:"GET",headers:{Authorization:`Bearer ${r.getters["user/accessToken"]}`}})).json()}async function w(){return await r.dispatch("user/refresh"),(await fetch(`${h}/admin/file-reports`,{method:"GET",headers:{Authorization:`Bearer ${r.getters["user/accessToken"]}`}})).json()}async function _(e){return await r.dispatch("user/refresh"),(await fetch(`${h}/admin/file-reports/decline/${e}`,{method:"POST",headers:{Authorization:`Bearer ${r.getters["user/accessToken"]}`}})).json()}async function v(e){return await r.dispatch("user/refresh"),(await fetch(`${h}/admin/file-reports/approve/${e}`,{method:"POST",headers:{Authorization:`Bearer ${r.getters["user/accessToken"]}`}})).json()}const k={data(){return{files:[],modal:{visible:!1,type:"",title:"",text:"",actionLabel:"",actionClass:"",reportID:null}}},created(){this.loadFileReports()},methods:{async loadFileReports(){try{const e=await w();if(console.log("Raw response from API:",e),!e||!e.reports){console.error("Invalid response format",e);return}const o=await Promise.all(e.reports.map(async d=>{try{const p=await y(d.id);d.hasEncryptionKey=!!(p&&p.key)}catch(p){console.error("Error fetching encryption key for file",d.id,p)}return d}));this.files=o}catch(e){if(console.error("Error loading file reports:",e),e.response){const o=await e.response.text();console.error("Response body:",o)}}},openModal(e,o){this.modal.reportID=o,e==="confirm"?(this.modal.title="Confirm Report",this.modal.text="Are you sure you want to confirm this report and pass it on for admin review?",this.modal.actionLabel="Confirm",this.modal.actionClass="px-4 py-2 rounded-lg text-white transition-colors bg-red-600 hover:bg-red-700"):e==="allow"&&(this.modal.title="Allow File",this.modal.text="Are you sure you want to allow this file?",this.modal.actionLabel="Allow",this.modal.actionClass="px-4 py-2 rounded-lg text-white transition-colors bg-green-600 hover:bg-green-700"),this.modal.type=e,this.modal.visible=!0},closeModal(){this.modal.visible=!1,this.modal.reportID=null},async handleAction(){try{this.modal.type==="confirm"?(await v(this.modal.reportID),console.log("Report confirmed ✅")):this.modal.type==="allow"&&(await _(this.modal.reportID),console.log("File allowed ✅")),this.closeModal(),this.loadFileReports()}catch(e){console.error("Error handling action:",e)}}}},z={class:"pt-6 md:pl-[1.9rem] pb-[1.9rem] pl-[0.4rem] select-none"},C={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},A={key:0,class:"col-span-full text-center p-6 rounded-xl bg-zinc-900/50 border border-zinc-800/50"},R={class:"rounded-lg overflow-hidden mb-4 bg-zinc-800/50 flex items-center justify-center h-40"},j=["src"],F={class:"space-y-1"},E={class:"text-lg font-semibold text-white truncate"},I={class:"text-sm text-zinc-400"},D={class:"text-sm text-zinc-500 truncate"},M={key:0,class:"text-sm text-red-400 font-medium mt-1"},T={class:"flex justify-between mt-4 pt-2 border-t border-zinc-800"},P=["onClick"],B=["onClick"],L={key:0,class:"fixed inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-50"},$={class:"bg-zinc-900 border border-zinc-700 rounded-xl p-6 w-[90%] max-w-md"},K={class:"text-xl font-semibold text-white mb-3"},O={class:"text-zinc-400 mb-6"},N={class:"flex justify-end gap-3"};function S(e,o,d,p,n,l){return c(),a("div",z,[o[3]||(o[3]=t("div",{class:"d-flex justify-content-between align-items-center flex-wrap grid-margin"},[t("h4",{class:"mb-4 mb-md-0 col-12 col-md-auto text-textPrimary"}," Dashboard / Moderator Panel ")],-1)),t("div",C,[n.files.length===0?(c(),a("div",A,[...o[2]||(o[2]=[t("p",{class:"text-lg font-semibold text-zinc-400"}," No reported files at the moment, check back later. ",-1)])])):m("",!0),(c(!0),a(b,null,g(n.files,s=>(c(),a("div",{key:s.id,class:"p-5 rounded-xl bg-zinc-900/50 border border-zinc-800/50 hover:border-zinc-700/50 transition-colors flex flex-col justify-between"},[t("div",null,[t("div",R,[t("img",{src:`https://api.alo.ne/file/${s.fileId}`||"",alt:"Preview",class:"object-cover w-full h-full"},null,8,j)]),t("div",F,[t("h3",E,i(s.name),1),t("p",I,"Uploaded: "+i(s.createdAt),1),t("p",D,"Key: "+i(s.encryption_key),1),s.reason?(c(),a("p",M," Reason: "+i(s.reason),1)):m("",!0)])]),t("div",T,[t("button",{onClick:u=>l.openModal("confirm",s.id),class:"px-3 py-2 text-sm bg-red-600/80 hover:bg-red-700 text-white rounded-lg transition-colors"}," Confirm Report ",8,P),t("button",{onClick:u=>l.openModal("allow",s.id),class:"px-3 py-2 text-sm bg-green-600/80 hover:bg-green-700 text-white rounded-lg transition-colors"}," Allow File ",8,B)])]))),128))]),n.modal.visible?(c(),a("div",L,[t("div",$,[t("h2",K,i(n.modal.title),1),t("p",O,i(n.modal.text),1),t("div",N,[t("button",{class:"px-4 py-2 rounded-lg bg-zinc-800 text-zinc-400 hover:bg-zinc-700 transition-colors",onClick:o[0]||(o[0]=(...s)=>l.closeModal&&l.closeModal(...s))}," Cancel "),t("button",{class:x(n.modal.actionClass),onClick:o[1]||(o[1]=(...s)=>l.handleAction&&l.handleAction(...s))},i(n.modal.actionLabel),3)])])])):m("",!0)])}const G=f(k,[["render",S],["__scopeId","data-v-aa1666fc"]]);export{G as default};
